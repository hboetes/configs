#!/bin/zsh
pauze=$(( ( 1000000000 - $epochtime[2] + 10000000) / 1000000000. ))

while sleep $pauze; do

    date_formatted=$(date "+%a %F %H:%M:%S")

    # Returns the battery status: "Full", "Discharging", or "Charging".
    battery_status=$(< /sys/class/power_supply/BAT0/status)
    cap=$(</sys/class/power_supply/BAT0/capacity)

    if ip r show 10.10.60.0/24|grep -q .; then
        vpn='ðŸ”'
    fi

    case $battery_status in
        'Not charging')
            bs='ðŸ”Œ'
            ;;
        'Discharging')
            if [[ $cap -lt 20 ]]; then
                systemctl suspend
            fi

            if [[ $cap -lt 25 ]]; then
                notify-send -t 500 -u critical 'ðŸª«Battery low!'
            fi

            if [[ $cap -lt 30 ]]; then
                bsicon='ðŸª«'
                if ((counter-- <= 0)); then
                    counter=30
                    notify-send -t 5000 -u normal 'ðŸª«Battery low!'
                fi
            else
                bsicon='ðŸ”‹'
            fi
            bs=$cap'% '$bsicon
            ;;
        'Charging')
            bs=$cap'% âš¡'
            ;;
    esac


    # Emojis and characters for the status bar
    # ðŸ’Ž ðŸ’» ðŸ’¡ ðŸ”Œ âš¡ ðŸ“ â†‘ ðŸ§ ðŸª«
    echo $vpn $bs $date_formatted
done
